name: CI / Deploy

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Quick lint (optional)
        run: |
          echo "No lint configured; add flake8/ruff if desired"

  deploy:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      - name: Show required secrets
        run: |
          echo "This workflow expects these repository secrets to be set:"
          echo "- TELEGRAM_BOT_TOKEN"
          echo "- DATABASE_URL"
          echo "- GROQ_API_KEY"
          echo "- TARGET_CHAT_ID"
          echo "- (optional) RAILWAY_API_KEY"
      # Example: deploy to Railway using Railway CLI (requires RAILWAY_API_KEY secret)
      - name: Deploy to Railway (example)
        if: ${{ secrets.RAILWAY_API_KEY != '' }}
        env:
          RAILWAY_API_KEY: ${{ secrets.RAILWAY_API_KEY }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          TARGET_CHAT_ID: ${{ secrets.TARGET_CHAT_ID }}
        run: |
          curl -sL https://railway.app/install.sh | sh
          # Example CLI usage; adapt to your Railway project and service
          railway whoami || echo "Logged into Railway"
          echo "(Add your deployment commands here)"
